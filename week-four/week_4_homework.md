# Week 4 Homework

**题目 01- 请你说一说什么是线程和进程？**

- 区别

  ```
  进程是资源分配的最小单位，是系统运行程序的基本单位。每个进程都有自己的独立地址内存空间。
  线程是程序执行的最小单位，是cpu调度和分配的基本单位。线程之间的堆空间和方法区共享，栈空间和程序计数器是独立的。
  ```

- 关系

  ```
  一个进程可以包含多个线程，且至少有一个线程，但一个线程只能属于一个进程。
  ```

- 线程的上下文切换是什么？

  ```
  线程的上下文切换指的是在cpu中切换线程执行的过程。
  一个cpu在同一时刻只能被一个线程使用，为了提高效率cpu采用时间片算法将cpu时间片轮流分配给多个线程。
  当一个时间片用完或被阻塞时，cpu会切换线程，把当前线程的执行位置挂起，记录在程序计数器里，用于下次执行时准确查找。然后选择另一个就绪的线程来运行。
  而这个记录与加载的过程，就叫上下文切换。
  ```

- 线程的并发与并行有啥区别？

  ```
  并发是指多个线程在同一时间段内交替执行，但在某一时刻只有一个线程在运行。
  并行是指多个线程在同一时刻同时执行，是真正的多任务处理。并行上限取决于cpu核数。
  ```

**题目 02- 使用了多线程会带来什么问题呢？**

- 能不能详细说说线程安全问题？

  ```
  多个线程同时执行时会访问共享变量，相互之间竞争和冲突，或同时运行一行代码，导致程序出现不稳定和不可预测的行为。而如果每次执行时的运行结果和单线程运行的结果一样，且变量值也与预期相符，则是线程安全的，反之是线程不安全的。
  
  想要解决线程安全问题，可以从线程同步（synchronized）、volatile、锁机制【JUC】（原子类（CAS）、锁（AQS））几方面来解决问题。
  
  线程同步synchronized同步锁机制，是为了保证在同一时刻，被修饰的代码块只会有一个线程在执行。可以保证并发程序的原子性，可见性，有序性的特性。
  
  volatile可以直接修饰变量，保证多线程情况下变量的可见性和有序性，保证所有线程看见的变量的值为一致的。即当一个线程修改了一个volatile变量的值后，其他线程能够立即看到这个变化。缺点为虽然volatile可以保证可见性，但是不能满足原子性。
  
  锁机制【JUC】（原子类（CAS）、锁（AQS））为java.util.concurrent包的缩写，此2包中定义了并发编程中很常见的工具，例如线程池、阻塞队列、同步器、原子类等等。
  其中的Atomic包（java.util.concurrent.atomic包）可以解决volatile直接修饰变量存在原子性的bug。
  原子类是利用CAS（Compare And Swap）算法实现的无锁的线程安全的操作类，可以保证对基本数据类型和引用类型的原子更新。
  CAS的执行函数可以看作CAS(V,E,N)，其中V：要读写的内存地址，E：进行比较的值（预期值），N：拟写入的新值。
  CAS算法是一种乐观锁的思想，当内存地址的V中的值等于预期值E时，将内存地址的V中的值改为N，否则会进行自旋操作，即通过比较内存中的值和预期值如果相同则更新否则重试至相同为止。
  AQS(AbstractQueuedSynchronizer)即队列同步器，是JUC并发包中的核心基础组件，为互斥锁。
  本质上是利用管程实现的，可以保证多个线程在临界区串行执行。
  AQS有独占模式和共享模式，独占模式为同一时刻只有一个线程能够获取同步状态，共享模式为同一时刻有多个线程获取同步状态。
  ```

- 原子性、有序性和可见性能不能深入的谈一下。

  ```
  原子性是指一个操作或者一系列操作要么全部执行成功，要么全部不执行，不能被其他线程干扰或者中断。
  有序性是指程序按照代码的先后顺序执行，可以保证程序的逻辑正确和预期结果正确。当指令重排时会出现无序问题。
  可见性是指当一个线程修改了共享资源的值后，其他线程能够及时地看到这个修改。如果没有可见性，那么可能会出现一个线程修改了变量的值，但是其他线程仍然读取到旧的值，导致逻辑错误。
  ```

**题目 03- 什么是死锁？如何排查死锁?**
排查过程最好详细说明，最少说一种排查方案，越多越好。

```
死锁是指多个线程因为竞争资源而互相阻塞，导致无法继续执行的现象。
死锁的产生需要满足：互斥、占有等待、不可抢占、和循环等待。

排除死锁可以使用jstack、Jconsole、jvisualvm等。
jstack可以在控制台输入jps找到死锁发生的进程
jstack [option] vmid命令可以看出死锁发生的原因。

Jconsole和jvisualvm可以在控制台输入指令弹出窗口。通过工具检测死锁可以查看死锁发生的原因。
```

 

